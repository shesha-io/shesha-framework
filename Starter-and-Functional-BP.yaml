# Variable 'artifactName' was defined in the Variables tab - tag test
# Agent Queue 'Azure Pipelines' was used with unrecognized Agent Specification, vmImage property must be specified to determine image - https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops&tabs=yaml#software
variables:
- name: BuildParameters.solution1
  value: Boxfusion.SheshaFunctionalTests.sln
- name: BuildParameters.solution2
  value: ShaCompanyName.ShaProjectName.sln
- name: BuildParameters.configuration
  value: release
- name: pack-version
  value: ""
- name: isMain
  value: $[eq(variables['Build.SourceBranch'], 'refs/heads/main')]

pr: none

trigger:
  tags:
    include:
    - '*'
  paths:
    exclude:
    - shesha-core
    - shesha-docs
    - shesha-reactjs
    - .github/workflows
  branches:
    include:
    - releases/*
    # - refs/tags/*
    exclude:
    - main
pool: 
  name: Azure Pipelines
  vmImage1: windows-latest
  vmImage2: ubuntu-latest

# name: 2.0.0.$(BuildID)
stages:
- stage: build
  jobs:
  - job: Job_1
    displayName: Build_Functional_Shesha_API
    pool:
      name: Azure Pipelines
      vmImage: windows-latest
    steps:
    - checkout: self
    - task: PowerShell@2
      displayName: Check to establish if this pipeline was triggered from a tag  
      inputs:
        targetType: 'inline'
        script: |
          # Write your PowerShell commands here.
          write-host "The build number is: $(Build.BuildNumber)"
          write-host $(Build.SourceBranch)
          $branch = 'Unknown'

          write-host "This is the commit id using the pre-defined variable Build.SourceVersion: $(Build.SourceVersion)"

          if ("$(Build.SourceBranch)" -like "*pull*"){
              write-host "Source Branch should be pull here: $(Build.SourceBranch)"
              $originalRefs = "$(Build.SourceBranch)".Replace("merge", "head")
              
              $commitRef   = Invoke-Expression "git ls-remote --refs origin $originalRefs"
              write-host "The commit info is: $commitRef "

              $commitSHA = $commitRef.Substring(0, 40)
              write-host "The commit id is: $commitSHA"

              $branch = git branch --contains $commitSHA --sort=-committerdate | %{ $_.TrimStart('*').Trim() } | Select-Object -First 1

              Write-Host "Latest branch: $branch"
              write-host "##vso[task.setvariable variable=currentBranch]$branch"

              $path = $branch
              $version = Split-Path $path -Leaf
              Write-Host $version

              write-host "##vso[task.setvariable variable=versionNo]$version"
          }           
          elseif ("$(Build.SourceBranch)" -like "*tags/release-*"){
              write-host "Source Branch should be tags here: $(Build.SourceBranch)"
              #$branch = Invoke-Expression "git branch -r --contains $(Build.SourceBranch)"

                $path = "$(Build.SourceBranch)"
                $version = Split-Path $path -Leaf
                Write-Host $version

                $releaseBranch = "refs/heads/releases/$version"

                write-host "##vso[task.setvariable variable=currentBranch]$releaseBranch"
                write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          elseif ("$(Build.SourceBranch)" -like "*releases/*"){
            write-host "Source Branch should be releases here: $(Build.SourceBranch)"            
            write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"

            $path = "$(Build.SourceBranch)"
            $version = Split-Path $path -Leaf
            Write-Host $version

            Set-Variable -Name "pack-version" -Value "$version"
            write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          else{
             write-host "Source Branch should not be tags or releases here: $(Build.SourceBranch)"
             write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"
             write-host "##vso[task.setvariable variable=versionNo]$(pack-version)"
          }
        workingDirectory: '$(System.DefaultWorkingDirectory)'      
    - task: PowerShell@2
      displayName: Output to console the current branch and version
      inputs:
        targetType: 'inline'
        script: |
          write-host "The current branch is: $(currentBranch)"
          write-host "The current version is: $(versionNo)"
        workingDirectory: '$(System.DefaultWorkingDirectory)'
    - task: PowerShell@2
      displayName: Create a txt file to carry the original branch name to the release pipeline  
      inputs:
        targetType: 'inline'
        script: |
          $variable = '$(currentBranch)'
          $variable | Out-File $(Build.ArtifactStagingDirectory)\branchName.txt
          Get-Content $(Build.ArtifactStagingDirectory)\branchName.txt
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: api-info-1'
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)'
        ArtifactName: 'api-info-1'
    - task: UseDotNet@2
      displayName: Use .NET Core sdk 6.x
      inputs:
        version: 6.x
    - task: Assembly-Info-NetCore@3
      displayName: 'Set Assembly Manifest Data'
      inputs:
        InsertAttributes: true
        VersionNumber: "$(versionNo)"
        FileVersionNumber: "$(versionNo)"
        InformationalVersion: "$(versionNo)"
        PackageVersion: "$(versionNo)"
    - task: DotNetCoreCLI@2
      displayName: dotnet Restore
      inputs:
        command: 'restore'
        projects: shesha-functional-tests/backend/**/*.csproj        
        feedsToUse: 'select'
        vstsFeed: '44b4667a-8963-403d-9962-bde66225adbd'
    - task: DotNetCoreCLI@2
      displayName: dotnet build
      inputs:
        projects: shesha-functional-tests/backend/Boxfusion.SheshaFunctionalTests.sln
        arguments: --configuration $(BuildParameters.configuration)
    - task: DotNetCoreCLI@2
      displayName: dotnet publish
      inputs:
        command: publish
        publishWebProjects: false
        projects: shesha-functional-tests/backend/Boxfusion.SheshaFunctionalTests.sln
        arguments: --configuration $(BuildParameters.configuration) --output $(build.artifactstagingdirectory) --no-build
        zipAfterPublish: false
        modifyOutputPath: false
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: functional-shesha-api'
      inputs:
        ArtifactName: functional-shesha-api
    - task: DotNetCoreCLI@2
      displayName: dotnet pack
      inputs:
        command: 'pack'
        packagesToPack: 'shesha-functional-tests/backend/src/**/*.csproj'
        configuration: '$(BuildParameters.configuration)'
        nobuild: true
        includesymbols: true
        includesource: true
        versioningScheme: 'byEnvVar'
        versionEnvVar: 'versionNo'

    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: Nuget packs'
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)'
        ArtifactName: 'packs-functional'
  - job: Job_2
    displayName: Build_Starter_Shesha_API
    pool:
      name: Azure Pipelines
      vmImage: windows-latest
    steps:
    - checkout: self
    - task: PowerShell@2
      displayName: Check to establish if this pipeline was triggered from a tag  
      inputs:
        targetType: 'inline'
        script: |
          # Write your PowerShell commands here.
          write-host "The build number is: $(Build.BuildNumber)"
          write-host $(Build.SourceBranch)
          $branch = 'Unknown'
          
          if ("$(Build.SourceBranch)" -like "*pull*"){
              write-host "Source Branch should be pull here: $(Build.SourceBranch)"
              $originalRefs = "$(Build.SourceBranch)".Replace("merge", "head")
              
              $commitRef   = Invoke-Expression "git ls-remote --refs origin $originalRefs"
              write-host "The commit info is: $commitRef "

              $commitSHA = $commitRef.Substring(0, 40)
              write-host "The commit id is: $commitSHA"

              $branch = git branch --contains $commitSHA --sort=-committerdate | %{ $_.TrimStart('*').Trim() } | Select-Object -First 1

              Write-Host "Latest branch: $branch"
              write-host "##vso[task.setvariable variable=currentBranch]$branch"

              $path = $branch
              $version = Split-Path $path -Leaf
              Write-Host $version

              write-host "##vso[task.setvariable variable=versionNo]$version"
          }           
          elseif ("$(Build.SourceBranch)" -like "*tags/release-*"){
              write-host "Source Branch should be tags here: $(Build.SourceBranch)"
              #$branch = Invoke-Expression "git branch -r --contains $(Build.SourceBranch)"

                $path = "$(Build.SourceBranch)"
                $version = Split-Path $path -Leaf
                Write-Host $version

                $releaseBranch = "refs/heads/releases/$version"

                write-host "##vso[task.setvariable variable=currentBranch]$releaseBranch"
                write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          elseif ("$(Build.SourceBranch)" -like "*releases/*"){
            write-host "Source Branch should be releases here: $(Build.SourceBranch)"            
            write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"

            $path = "$(Build.SourceBranch)"
            $version = Split-Path $path -Leaf
            Write-Host $version

            Set-Variable -Name "pack-version" -Value "$version"
            write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          else{
             write-host "Source Branch should not be tags or releases here: $(Build.SourceBranch)"
             write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"
             write-host "##vso[task.setvariable variable=versionNo]$(pack-version)"
          }
        workingDirectory: '$(System.DefaultWorkingDirectory)'
    - task: PowerShell@2
      displayName: Output to console the current branch and version
      inputs:
        targetType: 'inline'
        script: |
          write-host "The current branch is: $(currentBranch)"
          write-host "The current version is: $(versionNo)"
        workingDirectory: '$(System.DefaultWorkingDirectory)'
    - task: PowerShell@2
      displayName: Create a txt file to carry the original branch name to the release pipeline  
      inputs:
        targetType: 'inline'
        script: |
          $variable = '$(currentBranch)'
          $variable | Out-File $(Build.ArtifactStagingDirectory)\branchName.txt
          Get-Content $(Build.ArtifactStagingDirectory)\branchName.txt
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: api-info-2'
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)'
        ArtifactName: 'api-info-2'
    - task: UseDotNet@2
      displayName: Use .NET Core sdk 6.x
      inputs:
        version: 6.x
    - task: Assembly-Info-NetCore@3
      displayName: 'Set Assembly Manifest Data'
      inputs:
        InsertAttributes: true
        VersionNumber: "$(versionNo)"
        FileVersionNumber: "$(versionNo)"
        InformationalVersion: "$(versionNo)"
        PackageVersion: "$(versionNo)"
    - task: DotNetCoreCLI@2
      displayName: dotnet Restore
      inputs:
        command: 'restore'
        projects: shesha-starter/backend/**/*.csproj        
        feedsToUse: 'select'
        vstsFeed: '44b4667a-8963-403d-9962-bde66225adbd'
    - task: DotNetCoreCLI@2
      displayName: dotnet build
      inputs:
        projects: shesha-starter/backend/ShaCompanyName.ShaProjectName.sln
        arguments: --configuration $(BuildParameters.configuration)
    - task: DotNetCoreCLI@2
      displayName: dotnet publish
      inputs:
        command: publish
        publishWebProjects: false
        projects: shesha-starter/backend/ShaCompanyName.ShaProjectName.sln
        arguments: --configuration $(BuildParameters.configuration) --output $(build.artifactstagingdirectory) --no-build
        zipAfterPublish: false
        modifyOutputPath: false
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: starter-shesha-api'
      inputs:
        ArtifactName: starter-shesha-api
    - task: DotNetCoreCLI@2
      displayName: dotnet pack
      inputs:
        command: 'pack'
        packagesToPack: 'shesha-starter/backend/src/**/*.csproj'
        configuration: '$(BuildParameters.configuration)'
        nobuild: true
        includesymbols: true
        includesource: true
        versioningScheme: 'byEnvVar'
        versionEnvVar: 'versionNo'
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: Nuget packs'  
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)'
        ArtifactName: 'packs-starter'
  - job: Job_3
    displayName: Build_Functional_Shesha_AdminPortal
    pool:
      vmImage: ubuntu-latest
    steps:
    - task: PowerShell@2
      displayName: Check to establish if this pipeline was triggered from a tag  
      inputs:
        targetType: 'inline'
        script: |
          # Write your PowerShell commands here.
          write-host $(Build.SourceBranch)
          $branch = 'Unknown'
          if ("$(Build.SourceBranch)" -like "*pull*"){
              write-host "Source Branch should be pull here: $(Build.SourceBranch)"
              $originalRefs = "$(Build.SourceBranch)".Replace("merge", "head")
              
              $commitRef   = Invoke-Expression "git ls-remote --refs origin $originalRefs"
              write-host "The commit info is: $commitRef "

              $commitSHA = $commitRef.Substring(0, 40)
              write-host "The commit id is: $commitSHA"

              $branch = git branch --contains $commitSHA --sort=-committerdate | %{ $_.TrimStart('*').Trim() } | Select-Object -First 1

              Write-Host "Latest branch: $branch"
              write-host "##vso[task.setvariable variable=currentBranch]$branch"

              $path = $branch
              $version = Split-Path $path -Leaf
              Write-Host $version

              write-host "##vso[task.setvariable variable=versionNo]$version"
          }           
          elseif ("$(Build.SourceBranch)" -like "*tags/release-*"){
              write-host "Source Branch should be tags here: $(Build.SourceBranch)"
              #$branch = Invoke-Expression "git branch -r --contains $(Build.SourceBranch)"

                $path = "$(Build.SourceBranch)"
                $version = Split-Path $path -Leaf
                Write-Host $version

                $releaseBranch = "refs/heads/releases/$version"

                write-host "##vso[task.setvariable variable=currentBranch]$releaseBranch"
                write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          elseif ("$(Build.SourceBranch)" -like "*releases/*"){
            write-host "Source Branch should be releases here: $(Build.SourceBranch)"            
            write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"

            $path = "$(Build.SourceBranch)"
            $version = Split-Path $path -Leaf
            Write-Host $version

            Set-Variable -Name "pack-version" -Value "$version"
            write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          else{
             write-host "Source Branch should not be tags or releases here: $(Build.SourceBranch)"
             write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"
             write-host "##vso[task.setvariable variable=versionNo]$(pack-version)"
          }
        workingDirectory: 'shesha-functional-tests/adminportal'
    - task: PowerShell@2
      displayName: Output to console the current branch  
      inputs:
        targetType: 'inline'
        script: |
          # Write your PowerShell commands here.
          write-host "The current branch is: $(currentBranch)"
          write-host "The current version is: $(versionNo)"
        workingDirectory: 'shesha-functional-tests/adminportal'
    - task: NodeTool@0
      displayName: 'Use Node 14.21.1'
      inputs:
        versionSpec: 14.21.1
    # - task: Npm@1
    #   displayName: Install Latest Shesha
    #   inputs:
    #     command: custom
    #     workingDir: 'shesha-functional-tests/adminportal'
    #     verbose: false
    #     customCommand: install @shesha/reactjs@latest
    - task: Npm@1
      displayName: 'Npm Update Version'
      inputs:
        command: custom
        workingDir: shesha-functional-tests/adminportal
        verbose: false
        customCommand: 'version $(versionNo) --allow-same-version'
    - task: Npm@1
      displayName: 'Npm Install'
      inputs:
        command: custom
        workingDir: shesha-functional-tests/adminportal
        verbose: false
        customCommand: 'install --legacy-peer-deps'        
    - task: Npm@1
      displayName: Npm Build
      inputs:
        command: custom
        workingDir: 'shesha-functional-tests/adminportal'
        verbose: true
        customCommand: run build
    - task: ArchiveFiles@2
      inputs:
        rootFolderOrFile: 'shesha-functional-tests/adminportal'
        includeRootFolder: false
        archiveType: 'zip'
        archiveFile: '$(Build.ArtifactStagingDirectory)/frontend.zip'
        replaceExistingArchive: true
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: shesha-adminportal-functional'
      inputs:
        ArtifactName: adminportal-functional
  - job: Job_4
    displayName: Build_Starter_Shesha_AdminPortal
    pool:
      vmImage: ubuntu-latest
    steps:
    - task: PowerShell@2
      displayName: Check to establish if this pipeline was triggered from a tag  
      inputs:
        targetType: 'inline'
        script: |
          # Write your PowerShell commands here.
          write-host $(Build.SourceBranch)
          $branch = 'Unknown'
          if ("$(Build.SourceBranch)" -like "*pull*"){
              write-host "Source Branch should be pull here: $(Build.SourceBranch)"
              $originalRefs = "$(Build.SourceBranch)".Replace("merge", "head")
              
              $commitRef   = Invoke-Expression "git ls-remote --refs origin $originalRefs"
              write-host "The commit info is: $commitRef "

              $commitSHA = $commitRef.Substring(0, 40)
              write-host "The commit id is: $commitSHA"

              $branch = git branch --contains $commitSHA --sort=-committerdate | %{ $_.TrimStart('*').Trim() } | Select-Object -First 1

              Write-Host "Latest branch: $branch"
              write-host "##vso[task.setvariable variable=currentBranch]$branch"

              $path = $branch
              $version = Split-Path $path -Leaf
              Write-Host $version

              write-host "##vso[task.setvariable variable=versionNo]$version"
          }           
          elseif ("$(Build.SourceBranch)" -like "*tags/release-*"){
              write-host "Source Branch should be tags here: $(Build.SourceBranch)"
              #$branch = Invoke-Expression "git branch -r --contains $(Build.SourceBranch)"

                $path = "$(Build.SourceBranch)"
                $version = Split-Path $path -Leaf
                Write-Host $version

                $releaseBranch = "refs/heads/releases/$version"

                write-host "##vso[task.setvariable variable=currentBranch]$releaseBranch"
                write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          elseif ("$(Build.SourceBranch)" -like "*releases/*"){
            write-host "Source Branch should be releases here: $(Build.SourceBranch)"            
            write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"

            $path = "$(Build.SourceBranch)"
            $version = Split-Path $path -Leaf
            Write-Host $version

            Set-Variable -Name "pack-version" -Value "$version"
            write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          else{
             write-host "Source Branch should not be tags or releases here: $(Build.SourceBranch)"
             write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"
             write-host "##vso[task.setvariable variable=versionNo]$(pack-version)"
          }
        workingDirectory: 'shesha-starter/frontend'
    - task: PowerShell@2
      displayName: Output to console the current branch  
      inputs:
        targetType: 'inline'
        script: |
          # Write your PowerShell commands here.
          write-host "The current branch is: $(currentBranch)"
          write-host "The current version is: $(versionNo)"
        workingDirectory: 'shesha-starter/frontend'
    - task: NodeTool@0
      displayName: 'Use Node 14.21.1'
      inputs:
        versionSpec: 14.21.1
    # - task: Npm@1
    #   displayName: Install Latest Shesha
    #   inputs:
    #     command: custom
    #     workingDir: 'shesha-starter/frontend'
    #     verbose: false
    #     customCommand: install @shesha/reactjs@latest
    - task: Npm@1
      displayName: 'Npm Update Version'
      inputs:
        command: custom
        workingDir: shesha-starter/frontend
        verbose: false
        customCommand: 'version $(versionNo)--allow-same-version'
    - task: Npm@1
      displayName: 'Npm Install'
      inputs:
        command: custom
        workingDir: shesha-starter/frontend
        verbose: false
        customCommand: 'install --legacy-peer-deps'
    - task: Npm@1
      displayName: Npm Build
      inputs:
        command: custom
        workingDir: 'shesha-starter/frontend'
        verbose: true
        customCommand: run build
    - task: ArchiveFiles@2
      inputs:
        rootFolderOrFile: 'shesha-starter/frontend'
        includeRootFolder: false
        archiveType: 'zip'
        archiveFile: '$(Build.ArtifactStagingDirectory)/shesha-adminportal-starter.zip'
        replaceExistingArchive: true  
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: shesha-adminportal-starter'
      inputs:
        ArtifactName: adminportal-starter
  - job: Job_5
    displayName: Prepare Release if published
    pool:
      vmImage: ubuntu-latest
    steps:
    - task: PowerShell@2
      displayName: Check to establish if this pipeline was triggered from a tag  
      inputs:
        targetType: 'inline'
        script: |
          # Write your PowerShell commands here.
          write-host $(Build.SourceBranch)
          $branch = 'Unknown'
          if ("$(Build.SourceBranch)" -like "*pull*"){
              write-host "Source Branch should be pull here: $(Build.SourceBranch)"
              $originalRefs = "$(Build.SourceBranch)".Replace("merge", "head")
              
              $commitRef   = Invoke-Expression "git ls-remote --refs origin $originalRefs"
              write-host "The commit info is: $commitRef "

              $commitSHA = $commitRef.Substring(0, 40)
              write-host "The commit id is: $commitSHA"

              $branch = Invoke-Expression "git branch --contains $commitSHA --sort=-committerdate | Select-Object -Skip 1 -First 1"
              $branch = $branch.Trim()              
              Write-Host "Latest branch: $branch"
              write-host "##vso[task.setvariable variable=currentBranch]$branch"

              $path = $branch
              $version = Split-Path $path -Leaf
              Write-Host $version

              write-host "##vso[task.setvariable variable=versionNo]$version"
          }           
          elseif ("$(Build.SourceBranch)" -like "*tags*"){
              write-host "Source Branch should be tags here: $(Build.SourceBranch)"
              $branch = Invoke-Expression "git branch -r --contains $(Build.SourceBranch)"
              write-host "##vso[task.setvariable variable=currentBranch]$branch"

              $path = "$(Build.SourceBranch)"
              $version = Split-Path $path -Leaf
              Write-Host $version

              write-host "##vso[task.setvariable variable=currentBranch]$branch"
              write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          elseif ("$(Build.SourceBranch)" -like "*releases*"){
            
              $path = "$(Build.SourceBranch)"
              $version = Split-Path $path -Leaf
              Write-Host $version

              write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"
              write-host "##vso[task.setvariable variable=versionNo]$version"
          }
          else{
              $filePath = "package.json" #filepath
              $Jsonfile = Get-Content $filePath | ConvertFrom-Json
              
              $version = $Jsonfile.version
              write-host "Source Branch should not be releases here: $(Build.SourceBranch)"
              write-host "##vso[task.setvariable variable=currentBranch]$(Build.SourceBranch)"
              write-host "##vso[task.setvariable variable=versionNo]$version"
          }
        workingDirectory: '$(System.DefaultWorkingDirectory)'
    - task: PowerShell@2
      displayName: Delete Pipeline and Actions Yaml Files
      inputs:
        targetType: 'inline'
        script: |
          # Write your PowerShell commands here.
          ls
          Remove-Item -Recurse -Force .github
          ls
          Remove-Item -Force Starter-and-Functional-BP.yaml          
        workingDirectory: '$(System.DefaultWorkingDirectory)'
    - task: ArchiveFiles@2
      inputs:
        rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
        includeRootFolder: false
        archiveType: 'zip'
        archiveFile: '$(Build.ArtifactStagingDirectory)/shesha-framework-$(version).zip'
        replaceExistingArchive: true
    - task: ArchiveFiles@2
      inputs:
        rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
        includeRootFolder: false
        archiveType: 'tar'
        archiveFile: '$(Build.ArtifactStagingDirectory)/shesha-framework-$(version).tar.gz'
        replaceExistingArchive: true        
    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact: Release Version'
      inputs:
        ArtifactName: release-version
